<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Enquiry</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 700px; 
      margin: 30px auto; 
      padding: 10px; 
    }

    h2 { margin-top: 40px; }

    .enquiry {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background: #f7f7f7;
    }

    button {
      margin-right: 10px;
      padding: 5px 10px;
    }
  </style>
</head>

<body>

  <h2>Customer Enquiry Form</h2>

  <form id="enquiryForm">
    <input id="name" placeholder="Your Name" required style="width: 100%; padding: 8px;"><br><br>
    <input id="email" placeholder="Your Email" required style="width: 100%; padding: 8px;"><br><br>
    <textarea id="message" placeholder="Your Message" required style="width: 100%; padding: 8px; height: 100px;"></textarea><br><br>
    <button type="submit">Send Enquiry</button>
  </form>

  <hr>

  <h2>Staff Inbox</h2>
  <div id="inbox">Loading...</div>

  <!-- Firebase + Firestore -->
  <script type="module">
    import { initializeApp } 
      from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";

    import { 
      getFirestore, collection, addDoc, serverTimestamp,
      query, orderBy, onSnapshot, updateDoc, doc
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // ---------------------------------------------------------
    // ðŸ”¥ YOUR FIREBASE CONFIG â€” DO NOT TOUCH ANYTHING ELSE HERE
    // ---------------------------------------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyDD3MR1hl_yDGnwkF6kqAuT3Mzg29CZY08",
      authDomain: "customer-enquiry-20dbc.firebaseapp.com",
      projectId: "customer-enquiry-20dbc",
      storageBucket: "customer-enquiry-20dbc.appspot.com",
      messagingSenderId: "367088866332",
      appId: "1:367088866332:web:9e366ac945b794b3c23bd9"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // ---------------------------------------------------------
    // ðŸ”¥ HANDLE FORM SUBMISSION
    // ---------------------------------------------------------
    const form = document.getElementById("enquiryForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const enquiryData = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        message: document.getElementById("message").value,
        status: "New",
        createdAt: serverTimestamp()
      };

      await addDoc(collection(db, "enquiries"), enquiryData);

      alert("Your enquiry has been sent!");
      form.reset();
    });

    // ---------------------------------------------------------
    // ðŸ”¥ LIVE INBOX LISTENER (newest first)
    // ---------------------------------------------------------
    const inboxDiv = document.getElementById("inbox");

    const inboxQuery = query(
      collection(db, "enquiries"),
      orderBy("createdAt", "desc")
    );

    onSnapshot(inboxQuery, (snapshot) => {
      inboxDiv.innerHTML = ""; // Clear previous items

      snapshot.forEach((docSnap) => {
        const item = docSnap.data();
        const id = docSnap.id;

        const box = document.createElement("div");
        box.className = "enquiry";

        box.innerHTML = `
          <strong>${item.name}</strong> (${item.email})<br><br>
          <div>${item.message}</div><br>
          <p><strong>Status:</strong> ${item.status}</p>

          <button data-id="${id}" data-status="Contacted">Mark Contacted</button>
          <button data-id="${id}" data-status="Closed">Mark Closed</button>
        `;

        inboxDiv.appendChild(box);
      });
    });

    // ---------------------------------------------------------
    // ðŸ”¥ UPDATE STATUS BUTTONS
    // ---------------------------------------------------------
    document.addEventListener("click", async (e) => {
      if (e.target.dataset.id) {
        const docId = e.target.dataset.id;
        const newStatus = e.target.dataset.status;

        await updateDoc(doc(db, "enquiries", docId), { status: newStatus });
      }
    });

  </script>

</body>
</html>

